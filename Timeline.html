<svg
	style="height: {{(days.length * dayHeight) + daySquareStrokeWidth}}px; width: 500px"
>
	<g>
		{{#each days as day, i}}
			<rect
				y="{{impliedDayBorder + i * dayHeight}}"
				x="{{timelineLeft}}"
				width="{{dayWidth}}"
				height="{{dayHeight}}"
				class="day-box"
				stroke-width="{{daySquareStrokeWidth}}"
			>
			</rect>
			<rect
				y="{{i * dayHeight}}"
				x="{{timelineLeft}}"
				width="{{dayWidth}}"
				height="{{dayHeight / 2}}"
				class="nighttime-box"
			>
			</rect>
			<rect
				y="{{i * dayHeight + (dayHeight * 0.5)}}"
				x="{{timelineLeft}}"
				width="{{dayWidth}}"
				height="{{dayHeight / 2}}"
				class="daylight-box"
			>
			</rect>
		{{/each}}
	</g>
	<TransitioningGroup visible={{showWeekdayLabels}}>
		{{#each days as day, i}}
			<text
				y="{{impliedDayBorder + (i * dayHeight) + (dayHeight * 0.75)}}"
				x="{{timelineLeft + dayWidth + daySquareStrokeWidth + 20}}"
				text-anchor="start"
			>
				{{day.weekday}}
			</text>
		{{/each}}
	</TransitioningGroup>

	<TransitioningGroup visible={{showFridaySundayRange}}>
		<rect
			y="{{ fridaySundayRangeY }}"
			x="{{ dayLeftX - dayRangeBarWidth }}"
			width="{{ dayRangeBarWidth }}"
			height="{{ fridaySundayRangeHeight }}"
			class="green-fill"
		>
		</rect>
		<polyline
			fill="none"
			points="{{fridaySundayRangePointerPoints}}"
			class="green-stroke pointer-line"
		/>
		<text
			y={{fridaySundayRangePointerLeft.y + 4}}
			x={{fridaySundayRangePointerLeft.x - 4}}
			width={{fridaySundayRangePointerLeft.x}}
			text-anchor="end"
			class="green-fill"
		>
			Jesus's time in tomb (traditional)
		</text>
	</TransitioningGroup>

	<TransitioningGroup visible={{showDayOfMonth}}>
		{{#each days as day, i}}
			<text
				x={{ timelineLeft + (dayWidth / 2) }}
				width={{ dayWidth }}
				y={{ getDayY(i + .8) }}
				class="navy-fill"
				text-anchor="middle"
			>
				{{day.number}}
			</text>
		{{/each}}
	</TransitioningGroup>

</svg>

<style>
@import "./variables";

.day-box {
	stroke: $navy;
	fill: transparent;
}

.navy-fill {
	fill: $navy;
}

.daylight-box {
	fill: $yellow;
	fill-opacity: 0.5;
}
.nighttime-box {
	fill: $gray;
	fill-opacity: 0.5;
}

.green-fill {
	fill: $green;
}
.green-stroke {
	stroke: $green;
}

.pointer-line {
	stroke-width: 2;
}

text {
	font-size: 16px;
}
</style>

<script>
import TransitioningGroup from './TransitioningGroup.html'
import combine from 'combine-arrays'

const buildPoints = (...arrays) => arrays.map(([ x, y]) => `${x},${y}`).join(' ')

export default {
	data() {
		return {
			days: combine({
				number: [ 14, 15, 16, 17 ],
				weekday: [ 'Thursday', 'Friday', 'Saturday', 'Sunday' ]
			}),
			dayHeight: 100,
			dayWidth: 100,
			daySquareStrokeWidth: 2,
			timelineLeft: 300,
			dayRangeBarWidth: 20,
		}
	},
	computed: {
		impliedDayBorder: daySquareStrokeWidth => daySquareStrokeWidth / 2,
		highlightedDays: (showFridayHighlight, showSundayHighlight) => [
			false,
			showFridayHighlight,
			false,
			showSundayHighlight
		],
		getDayY: (dayHeight, impliedDayBorder) => dayPosition =>
			impliedDayBorder + (dayHeight * dayPosition),
		dayLeftX: (timelineLeft, daySquareStrokeWidth) =>
			timelineLeft - (daySquareStrokeWidth / 2),


		fridaySundayRangeY: getDayY => getDayY(1.875),
		fridaySundayRangeHeight: dayHeight => dayHeight * 1.5,
		fridaySundayRangeMidpoint: (fridaySundayRangeY, fridaySundayRangeHeight) =>
			fridaySundayRangeY + (fridaySundayRangeHeight / 2),
		fridaySundayRangePointerRightX: (dayLeftX, dayRangeBarWidth) =>
			dayLeftX - dayRangeBarWidth,
		fridaySundayRangePointerPoints: (fridaySundayRangePointerRightX, fridaySundayRangeMidpoint) =>
			buildPoints(
				[fridaySundayRangePointerRightX, fridaySundayRangeMidpoint],
				[fridaySundayRangePointerRightX - 20, fridaySundayRangeMidpoint],
			),
		fridaySundayRangePointerLeft: (fridaySundayRangePointerRightX, fridaySundayRangeMidpoint) => ({
				x: fridaySundayRangePointerRightX - 20,
				y: fridaySundayRangeMidpoint,
			})
	},
	components: {
		TransitioningGroup
	}
}
</script>
